<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Wheel of Names</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, Helvetica, sans-serif;
    background: #f4f6fb;
    text-align: center;
    padding: 20px;
}

h2 {
    margin-bottom: 10px;
}

textarea {
    width: 320px;
    height: 120px;
    padding: 10px;
    font-size: 14px;
}

button {
    margin-top: 10px;
    padding: 12px 28px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    background: #4f46e5;
    color: #fff;
    cursor: pointer;
}

button:hover {
    background: #4338ca;
}

canvas {
    margin-top: 20px;
    max-width: 100%;
}

#winner {
    margin-top: 20px;
    font-size: 22px;
    font-weight: bold;
    color: #16a34a;
}
</style>
</head>

<body>

<h2>üé° Wheel of Names</h2>

<textarea id="names" placeholder="Masukkan nama (1 baris = 1 nama)"></textarea><br>
<button onclick="spin()">SPIN üéØ</button>

<br>
<canvas id="wheel" width="400" height="400"></canvas>

<div id="winner"></div>

<script>
/* =======================
   AUDIO (BUILT-IN)
======================= */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playClickSound() {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = "triangle";
    osc.frequency.value = 400;
    gain.gain.value = 0.08;
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.03);
}

function playWinSound() {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = "sine";
    osc.frequency.setValueAtTime(600, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.6);
    gain.gain.value = 0.08;
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.7);
}

/* =======================
   WHEEL LOGIC
======================= */
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const radius = canvas.width / 2;

let names = [];
let angle = 0;
let spinning = false;

function drawWheel() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const slice = (2 * Math.PI) / names.length;

    names.forEach((name, i) => {
        ctx.beginPath();
        ctx.moveTo(radius, radius);
        ctx.fillStyle = i % 2 === 0 ? "#93c5fd" : "#fde68a";
        ctx.arc(radius, radius, radius, slice * i, slice * (i + 1));
        ctx.fill();

        ctx.save();
        ctx.translate(radius, radius);
        ctx.rotate(slice * i + slice / 2);
        ctx.textAlign = "right";
        ctx.fillStyle = "#111";
        ctx.font = "16px Arial";
        ctx.fillText(name, radius - 10, 5);
        ctx.restore();
    });

    // Pointer
    ctx.fillStyle = "red";
    ctx.beginPath();
    ctx.moveTo(radius - 12, 5);
    ctx.lineTo(radius + 12, 5);
    ctx.lineTo(radius, 25);
    ctx.fill();
}

function spin() {
    if (spinning) return;

    names = document.getElementById("names").value
        .split("\n")
        .map(n => n.trim())
        .filter(n => n !== "");

    if (names.length < 2) {
        alert("Masukkan minimal 2 nama!");
        return;
    }

    document.getElementById("winner").innerText = "";
    spinning = true;

    let speed = Math.random() * 0.5 + 0.6;
    let deceleration = 0.002;

    function animate() {
        if (speed > 0) {
            angle += speed;
            speed -= deceleration;

            ctx.save();
            ctx.translate(radius, radius);
            ctx.rotate(angle);
            ctx.translate(-radius, -radius);
            drawWheel();
            ctx.restore();

            playClickSound();
            requestAnimationFrame(animate);
        } else {
            spinning = false;
            const slice = (2 * Math.PI) / names.length;
            const index =
                Math.floor(names.length - (angle % (2 * Math.PI)) / slice) %
                names.length;

            document.getElementById("winner").innerText =
                "üèÜ Pemenang: " + names[index];

            playWinSound();
        }
    }

    animate();
}

// Initial draw
drawWheel();
</script>

</body>
</html>
